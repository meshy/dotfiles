setopt INTERACTIVECOMMENTS
# Above command explicitly enables comments starting with `#` in zsh

# Hack for tilix
# See https://gnunn1.github.io/tilix-web/manual/vteconfig/
if [ $TILIX_ID ] || [ $VTE_VERSION ]; then
    source /etc/profile.d/vte.sh
fi

############
# SETTINGS #
############

export EDITOR="nvim"
export MANPAGER="most"

# Disable zsh autocorrect
unsetopt correct_all

# Enable timestamps in history
setopt extendedhistory

# Back and forward through commands with CTRL-left/right
bindkey '5D' emacs-backward-word
bindkey '5C' emacs-forward-word
export WORDCHARS=''

# Virtualenvwrapper
export WORKON_HOME=~/venvs
export VIRTUALENVWRAPPER_PYTHON=`which python3`
export VIRTUAL_ENV_DISABLE_PROMPT=1
source `which virtualenvwrapper.sh`

# Go
export GOPATH=~/code/go
# Ruby
eval "$(rbenv init -)"

# fzf (fuzzy finder)
# CTRL-R overrides history search.
# CTRL-T dumps the searched path into the current command
# ALT-C changes directory. This is a PITA.
export FZF_DEFAULT_COMMAND='ag -g ""'
source /usr/share/fzf/key-bindings.zsh
source /usr/share/fzf/completion.zsh

# PATH
PATH="$HOME/.cargo/bin:/usr/local/heroku/bin:$PATH:$GOPATH/bin"

###########
# ALIASES #
###########

alias ccat='pygmentize -g'
alias f='flake8 . --exclude=node_modules'
alias g='git'
alias m="make test"
alias mf="make testfast"
alias m2="make test VERBOSITY=2"
alias pi="pip install"
alias t='tree -I "__pycache__|*.pyc" -C --dirsfirst'
alias vim='nvim'
alias v='nvim'
alias wo='workon'
alias fig='docker-compose'
alias reload='source ~/.zshrc'

# Alias hub to git, passing all args.
alias git=hub

# Bash Directory browsing shortcuts
alias k='tree'
alias ltr='ls -ltr'
alias r='screen -D -R'
alias ls='ls --color'
alias l='ls -lh'
alias ll='ls -la'

# Subpixel ordering for rotated monitors
alias vbgr="gsettings set org.gnome.settings-daemon.plugins.xsettings rgba-order 'vbgr'"
alias vrgb="gsettings set org.gnome.settings-daemon.plugins.xsettings rgba-order 'vbgr'"
alias rgb="gsettings set org.gnome.settings-daemon.plugins.xsettings rgba-order 'rgb'"

# How meta is this?!
alias cdd='cd ~/personal/dotfiles'

# Weather on the moon...
alias moon='curl wttr.in/moon'

# Dictionary/Thesaurus
alias dict="sdcv -c"

# Work around the infernal ghostscript
alias gs="git status"

# Open a file in vim with CTRL-P
bindkey -s ^p '^Uvim $(fzf)^M'

#############
# FUNCTIONS #
#############

# Create a virtual environment.
function mkvenv3 {
    defaultname=`basename $PWD`
    name=${1:-$defaultname}
    mkvirtualenv $name -a `pwd` -p `which python3`
    pip install -U pip setuptools wheel neovim ipython
}
function mkvenv2 {
    defaultname=`basename $PWD`
    name=${1:-$defaultname}
    mkvirtualenv $name -a `pwd` -p `which python2`
    pip install -U pip setuptools wheel neovim ipython
}

# Install requirements with pip
function pp {
    defaultfile='requirements.txt'
    requirementsfile=${1:-$defaultfile}
    pi -r $requirementsfile
}

# Check the weather!
function weather {
    defaultcity='oxford'
    curl wttr.in/${1:-$defaultcity}\?m
}


# Syntax highlighting needs to be at the end
source /usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

#######
# FUN #
#######

fortune | lolcat

# Default to ~/code/ directory
# Skip if already not in ~
if [ "$(pwd)" = "$HOME" ]; then
    cd ~/code/
fi
